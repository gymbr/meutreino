<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biblioteca de Treinos - Meu Treino</title>
    <link rel="icon" href="https://raw.githubusercontent.com/gymbr/meutreino/refs/heads/main/img/favicon.png" type="image/png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --bg-color: #212121;
            --card-color: #2c2c2c;
            --text-color: #f0f0f0;
            --secondary-text-color: #a0a0a0;
            --primary-color: #ffc107;
            --border-radius: 12px;
            --input-bg-color: #383838;
            --menu-width: 250px;
        }

        *, *::before, *::after { box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0; padding: 0; min-height: 100vh;
            display: flex; flex-direction: column;
        }

        .container { padding: 16px; max-width: 1200px; margin: 0 auto; flex-grow: 1; }

        .page-title {
            color: var(--primary-color);
            text-align: center;
            font-size: 1.6rem;
            margin-top: 16px;
            margin-bottom: 24px;
        }

        .header { display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; border-bottom: 1px solid var(--input-bg-color); position: sticky; top: 0; z-index: 10; background-color: var(--bg-color); }
        .header .menu-icon { font-size: 1.5rem; cursor: pointer; color: var(--primary-color); padding: 5px; }
        .header .header-link { text-decoration: none; color: inherit; position: absolute; left: 50%; transform: translateX(-50%); display: flex; align-items: center; gap: 10px; }
        .header .title { font-size: 1.25rem; font-weight: bold; display: flex; align-items: center; white-space: nowrap; }
        .header .title img { width: 24px; height: 24px; margin-right: 8px; border-radius: 5px; }
        .side-menu { height: 100%; width: 0; position: fixed; z-index: 1001; top: 0; left: 0; background-color: var(--card-color); overflow-x: hidden; transition: 0.3s; padding-top: 60px; box-shadow: 2px 0 5px rgba(0,0,0,0.5); display: flex; flex-direction: column; }
        .side-menu.open { width: var(--menu-width); }
        .side-menu .close-btn { position: absolute; top: 15px; right: 25px; font-size: 2rem; color: var(--primary-color); cursor: pointer; }
        .side-menu a { padding: 15px 20px; text-decoration: none; font-size: 1.1rem; color: var(--text-color); display: block; transition: 0.3s; border-bottom: 1px solid var(--input-bg-color); }
        .side-menu a:hover { background-color: #575757; color: var(--primary-color); }
        .side-menu a i {
          color: var(--primary-color);
          width: 20px; /* garante alinhamento */
          text-align: center;
        }
        .side-menu .close-btn,
        .sponsorship-box a {
            border-bottom: none;
        }
        .side-menu .sponsorship-box { margin-top: auto; padding: 20px; text-align: center; width: 100%; }
        .side-menu .sponsorship-box img { max-width: 100%; border-radius: var(--border-radius); width: 100%; }
        #page-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); z-index: 1000; display: none; }
        #page-overlay.show { display: block; }

        .selectors-box { display: flex; gap: 16px; margin-bottom: 24px; flex-wrap: wrap; }
        .selector-container { flex: 1; min-width: 250px; }
        .selector-container label { display: block; margin-bottom: 8px; color: var(--secondary-text-color); }
        .selector-container select { width: 100%; padding: 12px; background-color: var(--input-bg-color); border: 1px solid var(--primary-color); border-radius: 8px; color: var(--text-color); font-size: 1rem; cursor: pointer; }
        .selector-container select:disabled { cursor: not-allowed; opacity: 0.5; }
        .selector-container select:focus { outline: none; }

        #actions-container { display: flex; gap: 16px; flex-wrap: wrap; margin-bottom: 24px; }
        .action-btn {
            background-color: var(--primary-color);
            color: #1a1a1a;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1rem;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .action-btn:hover { background-color: #ffda6b; }

        /* --- ESTILOS DAS ABAS (TABS) --- */
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--input-bg-color);
            margin-bottom: 16px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }
        .tabs::-webkit-scrollbar { display: none; }
        .tabs .tab-link {
            background: none; border: none;
            color: var(--secondary-text-color);
            padding: 10px 16px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            white-space: nowrap;
            border-bottom: 2px solid transparent;
            transition: color 0.3s, border-bottom-color 0.3s;
        }
        .tabs .tab-link.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }
        .tabs .tab-link .tab-title { font-size: 1rem; }
        .tabs .tab-link .tab-subtitle { font-size: 0.8rem; display: block; }

        #workout-display { display: grid; gap: 16px; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); }
        .workout-day-card { background-color: var(--card-color); border-radius: var(--border-radius); padding: 16px; }
        .workout-day-card h2 { color: var(--primary-color); margin-top: 0; border-bottom: 1px solid var(--input-bg-color); padding-bottom: 8px; }
        .exercise-item { display: flex; align-items: center; margin-bottom: 12px; }
        .exercise-item img { width: 80px; height: 80px; object-fit: cover; border-radius: 8px; margin-right: 12px; background-color: #000; }
        .exercise-details p { margin: 0; }
        .exercise-details .exercise-name { font-weight: bold; font-size: 1rem; color: var(--text-color); }
        .exercise-details .exercise-meta { font-size: 0.85rem; color: var(--secondary-text-color); }
        .info-message, .error-message { text-align: center; color: var(--secondary-text-color); font-size: 1rem; padding: 20px; }
        .footer { text-align: center; padding: 8px 16px; color: var(--secondary-text-color); font-size: 0.875rem; background-color: #282828; margin-top: auto; }
        .workout-content { display: none; }
        .workout-content.active { display: block; }

        .professional-advice {
            padding: 16px;
            margin: 24px 0;
            background-color: var(--card-color);
            color: var(--secondary-text-color);
            border-radius: var(--border-radius);
            border-left: 5px solid var(--primary-color);
            text-align: center;
        }
        .professional-advice p { margin: 0; }

        @media (max-width: 600px) { .side-menu.open { width: min(var(--menu-width), 80vw); } }
    </style>
</head>
<body>

    <div id="side-menu" class="side-menu">
        <a href="javascript:void(0)" class="close-btn" onclick="closeNav()">&times;</a>
        <a href="."><i class="fa-solid fa-dumbbell"></i> Meu Treino</a>
        <a href="todos-exercicios"><i class="fa-solid fa-list"></i> Todos Exercícios</a>
        <a href="biblioteca-de-treinos"><i class="fa-solid fa-book"></i> Biblioteca de Treinos</a>
        <a href="calculadora-de-saude"><i class="fa-solid fa-calculator"></i> Calculadora de Saúde</a>
        <a href="personal-trainer"><i class="fa-solid fa-user"></i> Personal Trainer</a>
        <a href="baixar-aplicativo"><i class="fa-solid fa-download"></i> Baixar Aplicativo</a>
        <a href="sobre"><i class="fa-solid fa-circle-info"></i> Sobre</a>
        <div class="sponsorship-box">
            <a href="mailto:contato.meutreino@outlook.com?subject=Anunciar%20no%20App%20Meu%20Treino&body=Ol%C3%A1%2C%20gostaria%20de%20saber%20mais%20sobre%20como%20anunciar%20meu%20perfil%20no%20app%20Meu%20Treino.">
                <img src="https://raw.githubusercontent.com/gymbr/meutreino/refs/heads/main/img/anuncie_aqui.gif" alt="Anuncie Aqui">
            </a>
        </div>
    </div>
    <div id="page-overlay" onclick="closeNav()"></div>

    <div id="main-content-wrapper">
        <div class="header">
            <span class="menu-icon" onclick="openNav()">&#9776;</span>
            <a href="." class="header-link">
                <span class="title">
                    <img src="https://raw.githubusercontent.com/gymbr/meutreino/refs/heads/main/img/icone_treino.jpg" alt="Ícone de Treino">
                    Meu Treino
                </span>
            </a>
        </div>

        <div class="container">
            <h1 class="page-title">Biblioteca de Treinos</h1>

            <div class="selectors-box">
                <div class="selector-container">
                    <label for="gender-select">Gênero</label>
                    <select id="gender-select">
                        <option value="masculino" selected>Masculino</option>
                        <option value="feminino">Feminino</option>
                    </select>
                </div>
                <div class="selector-container">
                    <label for="category-select">Nível</label>
                    <select id="category-select">
                    </select>
                </div>
                <div class="selector-container">
                    <label for="workout-select">Treino</label>
                    <select id="workout-select" disabled>
                    </select>
                </div>
            </div>

            <div id="actions-container"></div>

            <div id="tabs-container" class="tabs"></div>

            <div id="workout-display">
                <p class="info-message">Selecione um objetivo e um treino para começar.</p>
            </div>

            <div class="professional-advice">
                <p><strong>Atenção:</strong> Antes de iniciar qualquer programa de treino, consulte um profissional de educação física ou um médico para garantir que os exercícios são adequados para você.</p>
            </div>
        </div>

        <footer class="footer">Feito por quem treina, para quem treina. 💪❤️</footer>
    </div>

    <script>
        // --- Side Menu Functions ---
        function openNav() { document.getElementById("side-menu").classList.add('open'); document.getElementById("page-overlay").classList.add('show'); }
        function closeNav() { document.getElementById("side-menu").classList.remove('open'); document.getElementById("page-overlay").classList.remove('show'); }
        document.addEventListener('keydown', (event) => { if (event.key === "Escape") closeNav(); });

        // --- LISTA DE TREINOS ---
        const listaDeTreinos = [
            
            {
                "nome": "Iniciante",
                "prefixo": "iniciante",
                "treinos": [
                    { "arquivo": "iniciante1(Adaptação Geral).json", "titulo": "Adaptação Geral" },
                    { "arquivo": "iniciante2(Alongamentos).json", "titulo": "Alongamentos" },
                    { "arquivo": "iniciante3(Básico com Peso).json", "titulo": "Básico com Peso" }
                ]
            },
            {
                "nome": "Intermediário",
                "prefixo": "intermediario",
                "treinos": [
                    { "arquivo": "intermediario1(Resistência).json", "titulo": "Resistência" },
                    { "arquivo": "intermediario2(Equilíbrio).json", "titulo": "Equilíbrio" },
                    { "arquivo": "intermediario3(Força Moderada).json", "titulo": "Força Moderada" }
                ]
            },
            {
                "nome": "Avançado",
                "prefixo": "avancado",
                "treinos": [
                    { "arquivo": "avancado1(Hipertrofia).json", "titulo": "Hipertrofia" },
                    { "arquivo": "avancado2(Força Máxima).json", "titulo": "Força Máxima" },
                    { "arquivo": "avancado3(Evolução).json", "titulo": "Evolução" }
                ]
            }
        ];

        let currentWorkoutData = null;

        document.addEventListener('DOMContentLoaded', () => {
            const categorySelect = document.getElementById('category-select');
            const workoutSelect = document.getElementById('workout-select');

            // 1. Popula o seletor de objetivos
            populateCategorySelect();

            // 2. Define "Iniciante" como o objetivo padrão
            categorySelect.value = 'iniciante';

            // 3. Popula os treinos com base no objetivo padrão
            populateWorkoutSelect(categorySelect.value);

            // 4. Define "Adaptação Geral" como o treino padrão
            workoutSelect.value = 'iniciante1(Adaptação Geral).json';

            // 5. Carrega e exibe o treino padrão
            fetchAndRenderWorkout(workoutSelect.value);


            categorySelect.addEventListener('change', () => {
                // Popula a lista de treinos quando o objetivo muda
                populateWorkoutSelect(categorySelect.value);
                // Carrega automaticamente o primeiro treino da nova lista
                if (workoutSelect.options.length > 0) {
                    workoutSelect.value = workoutSelect.options[0].value;
                    fetchAndRenderWorkout(workoutSelect.value);
                } else {
                    // Limpa a tela se a nova categoria não tiver treinos
                    document.getElementById('workout-display').innerHTML = '<p class="info-message">Nenhum treino encontrado para esta categoria.</p>';
                    document.getElementById('actions-container').innerHTML = '';
                    document.getElementById('tabs-container').innerHTML = '';
                    currentWorkoutData = null;
                }
            });

            workoutSelect.addEventListener('change', () => {
                if(workoutSelect.value){
                    fetchAndRenderWorkout(workoutSelect.value);
                }
            });
        });

        function populateCategorySelect() {
            const categorySelect = document.getElementById('category-select');
            categorySelect.innerHTML = ''; // Limpa quaisquer opções pré-existentes
            listaDeTreinos.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat.prefixo;
                option.textContent = cat.nome;
                categorySelect.appendChild(option);
            });
        }

        function populateWorkoutSelect(selectedCategoryPrefix) {
            const workoutSelect = document.getElementById('workout-select');
            workoutSelect.innerHTML = ''; // Remove opções antigas, incluindo a de "escolha um treino"

            if (!selectedCategoryPrefix) {
                workoutSelect.disabled = true;
                return;
            }

            const category = listaDeTreinos.find(cat => cat.prefixo === selectedCategoryPrefix);

            if (category && category.treinos && category.treinos.length > 0) {
                category.treinos.forEach(treino => {
                    const option = document.createElement('option');
                    option.value = treino.arquivo;
                    option.textContent = treino.titulo;
                    workoutSelect.appendChild(option);
                });
                workoutSelect.disabled = false;
            } else {
                workoutSelect.disabled = true;
            }
        }

        async function fetchAndRenderWorkout(workoutFile) {
            const display = document.getElementById('workout-display');
            const actionsContainer = document.getElementById('actions-container');
            const tabsContainer = document.getElementById('tabs-container');

            display.innerHTML = '<p class="info-message">Carregando treino...</p>';
            tabsContainer.innerHTML = '';
            actionsContainer.innerHTML = '';
            currentWorkoutData = null;

            try {
                const response = await fetch(`./treinos/${workoutFile}`);
                if (!response.ok) throw new Error(`Arquivo não encontrado: ${workoutFile}`);

                const workoutData = await response.json();
                currentWorkoutData = workoutData;

                renderWorkoutWithTabs(workoutData);
                createActionButtons();

            } catch (error) {
                console.error("Erro ao carregar o treino:", error);
                display.innerHTML = `<p class="error-message">Ops! Ocorreu um erro ao carregar o treino.</p>`;
            }
        }

        function renderWorkoutWithTabs(data) {
            const display = document.getElementById('workout-display');
            const tabsContainer = document.getElementById('tabs-container');
            display.innerHTML = '';
            tabsContainer.innerHTML = '';

            if (!data.workouts || Object.keys(data.workouts).length === 0) {
                display.innerHTML = `<p class="info-message">Este arquivo de treino parece estar vazio ou no formato incorreto.</p>`;
                return;
            }

            const workoutDays = Object.keys(data.workouts);

            workoutDays.forEach((dayKey, index) => {
                const titleInfo = data.tabNames[dayKey];

                // Criar Aba (Tab)
                const tabLink = document.createElement('button');
                tabLink.className = 'tab-link';
                tabLink.dataset.tab = dayKey;
                tabLink.innerHTML = `<span class="tab-title">${titleInfo.title}</span><span class="tab-subtitle">${titleInfo.subtitle}</span>`;
                tabsContainer.appendChild(tabLink);

                // Criar Conteúdo do Treino
                const workoutContent = document.createElement('div');
                workoutContent.id = `content-${dayKey}`;
                workoutContent.className = 'workout-content';

                const dayCard = document.createElement('div');
                dayCard.className = 'workout-day-card';

                const exercisesArray = data.workouts[dayKey];

                exercisesArray.forEach(exercise => {
                    const exerciseItem = document.createElement('div');
                    exerciseItem.className = 'exercise-item';

                    exerciseItem.innerHTML = `
                        <img src="${exercise.image}" alt="${exercise.name}" onerror="this.src='https://raw.githubusercontent.com/gymbr/meutreino/refs/heads/main/img/icone_treino.jpg';">
                        <div class="exercise-details">
                            <p class="exercise-name">${exercise.name}</p>
                            <p class="exercise-meta">Séries: ${exercise.series} | Repetições: ${exercise.reps}</p>
                        </div>
                    `;
                    dayCard.appendChild(exerciseItem);
                });
                workoutContent.appendChild(dayCard);
                display.appendChild(workoutContent);

                // Lógica de clique na aba
                tabLink.addEventListener('click', () => {
                    document.querySelectorAll('.tab-link').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.workout-content').forEach(c => c.classList.remove('active'));
                    tabLink.classList.add('active');
                    workoutContent.classList.add('active');
                });

                // Ativar a primeira aba por padrão
                if (index === 0) {
                    tabLink.classList.add('active');
                    workoutContent.classList.add('active');
                }
            });
        }

        function createActionButtons() {
            const actionsContainer = document.getElementById('actions-container');
            actionsContainer.innerHTML = '';

            if (!currentWorkoutData) return;

            // Botão de Salvar
            const saveButton = document.createElement('button');
            saveButton.id = 'save-btn'
            saveButton.className = 'action-btn';
            saveButton.innerHTML = `<i class="fas fa-save"></i> Salvar Treino`;
            saveButton.onclick = saveToMyWorkouts;
            actionsContainer.appendChild(saveButton);

            // Botão de Download
            const downloadButton = document.createElement('button');
            downloadButton.className = 'action-btn';
            downloadButton.innerHTML = `<i class="fas fa-file-download"></i> Baixar Treino`;
            downloadButton.onclick = downloadCurrentWorkout;
            actionsContainer.appendChild(downloadButton);

            // Botão de Compartilhar
            const shareButton = document.createElement('button');
            shareButton.className = 'action-btn';
            shareButton.innerHTML = `<i class="fas fa-share-alt"></i> Compartilhar`;
            shareButton.onclick = shareCurrentWorkout;
            actionsContainer.appendChild(shareButton);
        }

        function downloadCurrentWorkout() {
            if (!currentWorkoutData) {
                alert("Não há dados de treino para baixar.");
                return;
            }

            const categorySelect = document.getElementById('category-select');
            const workoutSelect = document.getElementById('workout-select');

            const categoryName = categorySelect.options[categorySelect.selectedIndex].text.replace(/ /g, '_');
            const workoutName = workoutSelect.options[workoutSelect.selectedIndex].text.replace(/ /g, '_');
            const filename = `${categoryName}_${workoutName}.json`;

            const jsonString = JSON.stringify(currentWorkoutData, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        async function shareCurrentWorkout() {
            const workoutSelect = document.getElementById('workout-select');
            const selectedWorkoutFile = workoutSelect.value;

            if (!selectedWorkoutFile) {
                alert("Nenhum treino selecionado para compartilhar.");
                return;
            }

            // Constrói a URL de destino (longa) com o nome do arquivo JSON
            const baseUrl = new URL('.', window.location.href).href;
            const urlLonga = `${baseUrl}?import-workout=${encodeURIComponent(selectedWorkoutFile)}`;

            try {
                // Chama a API para encurtar o link
                const response = await fetch(`https://is.gd/create.php?format=json&url=${encodeURIComponent(urlLonga)}`);
                if (!response.ok) throw new Error('A resposta da API de encurtamento não foi bem-sucedida.');

                const data = await response.json();
                const shortUrl = data.shorturl;

                if (!shortUrl) {
                    // Fallback caso a API não retorne a URL curta
                    throw new Error(data.errormessage || 'Não foi possível gerar o link curto.');
                }

                const shareData = {
                    title: 'Meu Treino',
                    text: 'Confira este treino que encontrei no app Meu Treino!',
                    url: shortUrl // Usa o link curto aqui
                };

                // Tenta usar a API de compartilhamento nativa
                if (navigator.share) {
                    await navigator.share(shareData);
                } else {
                    // Fallback: copia o link curto para a área de transferência
                    await navigator.clipboard.writeText(shortUrl);
                    alert('Link de compartilhamento copiado para a área de transferência!');
                }
            } catch (err) {
                console.error('Erro ao compartilhar ou encurtar o link:', err);
                // Fallback final: se tudo falhar, avisa o usuário
                alert('Ocorreu um erro ao gerar o link curto. Tente novamente mais tarde.');
            }
        }

        function saveToMyWorkouts() {
            if (!currentWorkoutData) {
                alert("Nenhum treino selecionado para salvar.");
                return;
            }

            if (confirm("Isso irá substituir seus treinos atuais na página principal. Deseja continuar?")) {
                try {
                    localStorage.setItem('workouts', JSON.stringify(currentWorkoutData.workouts));
                    localStorage.setItem('tabNames', JSON.stringify(currentWorkoutData.tabNames));
                    // Define a aba ativa para ser a primeira do novo treino
                    localStorage.setItem('lastActiveTab', Object.keys(currentWorkoutData.workouts)[0]);

                    alert("Treino salvo com sucesso! Você será redirecionado para a página principal.");
                    window.location.href = '.'; // Redireciona para o index.html
                } catch (error) {
                    console.error("Erro ao salvar o treino no localStorage:", error);
                    alert("Ocorreu um erro ao salvar o treino. Verifique o console para mais detalhes.");
                }
            }
        }
    </script>

</body>
</html>
